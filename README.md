## An Abductive Learning Framework For Automatically Solving Math Problems
This code is our implementation of paper [An Abductive Learning Framework For Automatically Solving Math Problems](), which is based on the famous NLP framework [AllenNLP](https://github.com/allenai/allennlp).

### install
```bash
pip install -r requirements.txt
```

### dataset format
We experiment on the [Mathematics Dataset](https://github.com/deepmind/mathematics_dataset). The data set is preprocessed into the following form, where one line is the description of the problem, the next line is separated by ###, the first half is the answer, the second half is the program(may not have).
> What is the first derivative of 5018*w**4 + 15*w**3 + 15*w + 12680810 wrt w? <br>
20072*w**3 + 45*w**2 + 15###pos#3 pos#8 pos#6 argc#3 api#diff extra#@end@ <br>
Calculate the remainder when 7687189 is divided by 3441. <br>
3436###pos#8 pos#4 argc#2 api#Mod extra#@end@

### models
We release 3 models(extraction code: eg39)

- [program-searching](https://pan.baidu.com/s/1U3VN-Dy02wQg8AbKBP8oVA)
- [abl-sym](https://pan.baidu.com/s/1U3VN-Dy02wQg8AbKBP8oVA)
- [abl-sym-tp](https://pan.baidu.com/s/1U3VN-Dy02wQg8AbKBP8oVA)


### search
To execute program-searching procedure, use `warm_up_search.py`, `program_search.py`, `curriculum_search.py`.
During the execution process, the searched programs need to be used to train the program-searching model, 
and the programs generated by the search model will further help the search process. 
For the training process, see the training section below.
```bash
python dmmath/search/warm_up_search.py \
    --data ...
python dmmath/search/program_search.py \
    --data ...
python dmmath/search/curriculum_search.py \
    --model .. \
    --data ...
```
### training
To train ABL-sym model, use `train_dist_transformer.py`, the `workdir` directory should include `experiment.config`, which is used for training configuration.
```bash
python dmmath/nlp/train_dist_transformer.py \
    ---workdir ... \
    --local_rank ...
```

### prediction
To predict results, use `predict_mix_transformer.py`, the `data` should be preprocessed as above. 
```bash
python dmmath/nlp/predict_mix_transformer.py \
    --model ... \
    --data ... \
    --result_dir ... \
    --target_limit_decode_steps ... \
    --batch_size ... \
    --cuda ...
```

### evaluation
To evaluate ABL-Sym on Mathematics Dataset, use `evaluate_mix_transformer.py`, the `result_path` is the prediction result path using `predict_mix_transformer.py`:
```bash
python dmmath/nlp/evaluate_mix_transformer.py \
    --result ...
```
